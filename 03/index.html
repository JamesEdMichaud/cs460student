<html>
<head>
    <meta charset="UTF-8" />
    <style>
        html, body {
            background-color:#000;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden !important;
        }
    </style>
    <script src="https://threejs.org/build/three.min.js" type="text/javascript"></script>
    <script src="https://threejs.org/examples/js/controls/TrackballControls.js" type="text/javascript"></script>
    <script>
        window.onload = function() {
            fov   = 75;
            ratio = window.innerWidth / window.innerHeight;
            zNear = 1;
            zFar  = 10000;

            camera       = new THREE.PerspectiveCamera(fov, ratio, zNear, zFar);
            renderer     = new THREE.WebGLRenderer();
            scene        = new THREE.Scene();
            ambientLight = new THREE.AmbientLight( 0x404040, 1 );
            light        = new THREE.DirectionalLight( 0xffffff, 1 );
            controls     = new THREE.TrackballControls( camera, renderer.domElement );

            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );

            camera.position.set(0, 0, 100);
            light.position.set( 10, 100, 10 );

            invisible_plane = new THREE.Mesh(
                    new THREE.PlaneBufferGeometry( 10000, 10000 ),      // geometry
                    new THREE.MeshBasicMaterial( { visible: false } )   // material
            );

            scene.add( ambientLight );
            scene.add( light );
            scene.add( invisible_plane );

            animate();


            shapes = [knot, box, sphere, oct, cone, ring];
            sceneShapes = [];

            knot = function(color) {
                var geometry = new THREE.TorusKnotBufferGeometry( 10, 1.5, 64, 8, 4, 3 );
                var material = new THREE.MeshStandardMaterial( { color: color } );
                return new THREE.Mesh( geometry, material );
            }

            box = function(color) {
                var geometry = new THREE.BoxBufferGeometry( 20, 20, 20);
                var material = new THREE.MeshStandardMaterial({ color: color });
                return new THREE.Mesh( geometry, material);
            }

            sphere = function(color) {
                var geometry = new THREE.SphereBufferGeometry( 10, 16, 16 );
                var material = new THREE.MeshStandardMaterial( {color: color} );
                return new THREE.Mesh( geometry, material );
            }

            oct = function(color) {
                var geometry = new THREE.OctahedronBufferGeometry( 10, 0 );
                var material = new THREE.MeshStandardMaterial( { color: color } );
                return new THREE.Mesh( geometry, material );
            }

            cone = function(color) {
                var geometry = new THREE.ConeBufferGeometry( 10, 20, 8 );
                var material = new THREE.MeshStandardMaterial( { color: color } );
                return new THREE.Mesh( geometry, material );
            }

            ring = function(color) {
                var geometry = new THREE.RingBufferGeometry( 10, 20, 5 );
                var material = new THREE.MeshStandardMaterial( { color: color, side: THREE.DoubleSide } );
                return new THREE.Mesh( geometry, material );
            }

            addShape = function(x, y, z) {
                var randomShape = Math.floor(Math.random() * shapes.length);
                var randomColor = Math.floor(Math.random()*0xFFFFFF)
                var shape = shapes[randomShape](randomColor);
                shape.position.set(x, y, z);
                sceneShapes.push(shape);
                scene.add(shape);
            }

            // Shift+RightClick to clear all shapes
            renderer.domElement.oncontextmenu = function(e) {
                if (!e.shiftKey) {
                    e.preventDefault();
                    return false;
                }
                var count = sceneShapes.length;
                for (var i = 0; i < count; i++) {
                    scene.remove(sceneShapes.shift());
                }
            }

            renderer.domElement.onclick = function(e) {
                if (!e.shiftKey) {
                    e.preventDefault();
                    return false;
                }

                pixel_coords = new THREE.Vector2( e.clientX, e.clientY );
                vp_coords = new THREE.Vector2( ( e.clientX / window.innerWidth  ) * 2 - 1,
                                              -( e.clientY / window.innerHeight ) * 2 + 1);
                vp_coords_near = new THREE.Vector3( vp_coords.x, vp_coords.y, 0);

                raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(vp_coords_near, camera);
                intersects = raycaster.intersectObject(invisible_plane);

                console.log('Pixel coordinates', pixel_coords);
                console.log('Viewport coordinates', vp_coords);
                console.log('Ray to Invisible Plane', intersects[0].point);

                addShape(intersects[0].point.x, intersects[0].point.y, intersects[0].point.z);
            };
        };

        function animate() {
            requestAnimationFrame( animate );
            controls.update();
            renderer.render( scene, camera );
        };
    </script>
</head>
<body></body>
</html>